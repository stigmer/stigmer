# `stigmer new` Command - Complete Setup Documentation

This document describes the complete setup for the `stigmer new` command, including the demo repository, SDK templates, and zero-config quickstart experience.

## âœ… What's Been Completed

### 1. Demo Repository Created

**Repository:** [`stigmer/hello-stigmer`](https://github.com/stigmer/hello-stigmer)

**Contents:**
- Simple Go calculator implementation
- Comprehensive tests
- **PR #1:** "Add Divide function" (must remain open for demos)
- Public repository (no authentication required)
- Clean, reviewable code perfect for AI analysis

**Purpose:**
- Serves as the target for `stigmer new` generated code
- Provides real PR for AI code review demonstration
- Zero-config (public API, no tokens needed)

**URL:** https://github.com/stigmer/hello-stigmer  
**PR #1:** https://github.com/stigmer/hello-stigmer/pull/1

---

### 2. SDK Template Updated

**Location:** `stigmer/sdk/go/templates/templates.go`

**Function:** `AgentAndWorkflow()`

**What it generates:**
```go
// Creates two resources:
// 1. AI Agent: PR reviewer with natural language instructions
// 2. Workflow: Fetches PR from hello-stigmer and analyzes it

// Zero configuration required:
// - Uses public GitHub API (no tokens)
// - Hardcoded to analyze stigmer/hello-stigmer PR #1
// - Works out of the box with `stigmer run`
```

**Key features:**
- âœ… Agent + Workflow in one file
- âœ… Real GitHub API integration
- âœ… Zero configuration
- âœ… Demonstrates `workflow.CallAgent()`
- âœ… ~70 lines of clean, commented code

**Tests:** All passing âœ…
```bash
cd sdk/go/templates && go test -v
# PASS: All templates compile and validate
```

---

### 3. Zero-Config Philosophy

**The Experience:**
```bash
$ stigmer new my-first-project
âœ“ Creating project structure
âœ“ Generating files
âœ“ Installing dependencies

ðŸŽ‰ Project created!

$ cd my-first-project

$ stigmer run
âš¡ Starting workflow: review-demo-pr
â†’ Fetching PR from github.com/stigmer/hello-stigmer
â†’ Analyzing with AI agent...
âœ“ Review complete!
```

**Total time:** < 30 seconds from `stigmer new` to AI code review

**What users get:**
- Working example immediately
- No configuration files to edit
- No tokens to set up
- Real AI analyzing real code

---

## ðŸ“ Project Structure Generated by `stigmer new`

```
my-stigmer-project/
â”œâ”€â”€ stigmer.yaml      # Project metadata (4 lines)
â”œâ”€â”€ main.go          # Agent + Workflow (~70 lines, heavily commented)
â”œâ”€â”€ go.mod           # Go dependencies
â”œâ”€â”€ .gitignore       # Standard ignores
â””â”€â”€ README.md        # Quick start guide (to be implemented)
```

**Minimal and focused:**
- No `environment.yaml` (zero config!)
- No `instance.yaml` (advanced topic)
- Just the essentials to get started

---

## ðŸŽ¯ Design Decisions

### Why This Approach?

**Simplicity over completeness:**
- First demo should be **magical**, not **educational**
- Show value in <30 seconds
- Introduce complexity later in docs

**Public API over authentication:**
- No GitHub tokens required
- No environment variables to set
- Works immediately for everyone

**Real code over fake data:**
- Analyzes actual PR from actual repository
- AI produces meaningful feedback
- Feels like production use case

**Single file over multiple manifests:**
- Everything in `main.go`
- No YAML confusion upfront
- Progressive disclosure (teach config later)

---

## ðŸ”„ Implementation Status

### âœ… Completed

- [x] Created `stigmer/hello-stigmer` repository
- [x] Added calculator code with tests
- [x] Created PR #1 with real reviewable changes
- [x] Updated SDK template (`AgentAndWorkflow()`)
- [x] Verified template compiles and tests pass
- [x] Documented the setup
- [x] Pushed all changes to GitHub

### ðŸš§ To Be Implemented

- [ ] Implement `stigmer new` command in CLI
  - Location: `client-apps/cli/cmd/stigmer/root/new.go`
  - Should use `templates.AgentAndWorkflow()`
  - Generate project structure
  - Run `go mod tidy`
  - Show success message with next steps

- [ ] Create README.md template
  - Quick start (3 steps max)
  - What's included
  - How to customize
  - Link to docs for advanced topics

- [ ] Test the full flow
  - `stigmer new my-project`
  - `cd my-project`
  - `stigmer run`
  - Verify AI review output

- [ ] Update CLI documentation
  - Add `stigmer new` to COMMANDS.md
  - Update main README with quickstart
  - Add examples to docs site

---

## ðŸ“ Template Content

The SDK template generates this `main.go`:

### Structure:
1. **Imports** - SDK packages
2. **Part 1: Agent** - AI code reviewer
3. **Part 2: Workflow** - PR fetch + analysis pipeline
4. **Summary** - Logs showing what was created

### Demonstrates:
- `stigmer.Run()` for context management
- `agent.New()` with natural language instructions
- `workflow.New()` with task chaining
- `workflow.HttpGet()` for API calls
- `workflow.CallAgent()` for AI integration
- Field references for task dependencies

### Educational value:
- Shows complete agent-workflow pattern
- Real-world API integration
- Production-like code structure
- Clear comments explaining each part

---

## ðŸŽ¬ Next Steps for Implementation

### 1. Implement `stigmer new` Command

Create `client-apps/cli/cmd/stigmer/root/new.go`:

```go
package root

import (
    "github.com/stigmer/stigmer/sdk/go/templates"
    // ... other imports
)

func NewCommand() *cobra.Command {
    return &cobra.Command{
        Use:   "new [project-name]",
        Short: "Create a new Stigmer project",
        Args:  cobra.MaximumNArgs(1),
        Run:   newHandler,
    }
}

func newHandler(cmd *cobra.Command, args []string) {
    // 1. Get project name (default: "stigmer-project")
    // 2. Create directory
    // 3. Generate stigmer.yaml
    // 4. Generate main.go using templates.AgentAndWorkflow()
    // 5. Generate go.mod
    // 6. Generate .gitignore
    // 7. Generate README.md
    // 8. Run `go mod tidy`
    // 9. Show success message
}
```

### 2. Create README Template

Simple, action-oriented:
- 3-step quick start
- What it does (1 paragraph)
- How to customize (brief)
- Links to docs for advanced topics

### 3. Test End-to-End

```bash
# Test the complete flow
stigmer new test-project
cd test-project
stigmer run

# Verify:
# - Project created successfully
# - All files generated
# - Dependencies installed
# - Agent and workflow created
# - PR fetched from hello-stigmer
# - AI produces code review
```

### 4. Documentation

Update:
- `client-apps/cli/COMMANDS.md` - Add `stigmer new` section
- Main README - Add quickstart example
- Docs site - Add "Getting Started" guide

---

## ðŸ”— Links and References

### Repositories
- **hello-stigmer:** https://github.com/stigmer/hello-stigmer
- **PR #1 (demo):** https://github.com/stigmer/hello-stigmer/pull/1
- **Stigmer SDK:** `stigmer/sdk/`
- **Stigmer CLI:** `stigmer/client-apps/cli/`

### Code Locations
- **SDK Template:** `stigmer/sdk/go/templates/templates.go::AgentAndWorkflow()`
- **Template Tests:** `stigmer/sdk/go/templates/templates_test.go`
- **CLI Commands:** `stigmer/client-apps/cli/cmd/stigmer/root/`

### Documentation
- **hello-stigmer Internal Docs:** `hello-stigmer/STIGMER_QUICKSTART.md`
- **SDK Templates README:** `sdk/go/templates/README.md`
- **This Document:** `STIGMER_NEW_COMMAND_SETUP.md`

---

## ðŸŽ¯ Success Criteria

The `stigmer new` implementation is complete when:

1. âœ… User runs `stigmer new my-project`
2. âœ… Project is created with all files
3. âœ… Dependencies are installed automatically
4. âœ… User runs `stigmer run`
5. âœ… Workflow executes successfully
6. âœ… AI agent analyzes PR #1 from hello-stigmer
7. âœ… Code review is displayed to user
8. âœ… Total time from `stigmer new` to result: < 30 seconds

**The magic moment:** User sees AI analyzing real code with zero configuration.

---

## ðŸš€ Command Preview

### What users will type:

```bash
# Create new project
stigmer new my-first-agent

# Navigate and run
cd my-first-agent
stigmer run
```

### What users will see:

```
$ stigmer new my-first-agent

âœ“ Creating project structure
âœ“ Generating example files
  â€¢ stigmer.yaml
  â€¢ main.go (AI-powered PR reviewer)
  â€¢ go.mod
  â€¢ .gitignore
  â€¢ README.md
âœ“ Installing dependencies

ðŸŽ‰ Project created successfully!

What's included:
  â€¢ AI Agent:   Code reviewer (natural language instructions)
  â€¢ Workflow:   Fetches real PR from GitHub + analyzes it
  â€¢ Zero setup: No tokens or config needed!

Try it now:
  cd my-first-agent
  stigmer run

$ cd my-first-agent

$ stigmer run

âš¡ Starting workflow: review-demo-pr

â†’ fetch-pr: Fetching PR from GitHub...
  âœ“ Got PR #1: "Add Divide function"

â†’ fetch-diff: Fetching code changes...
  âœ“ Got 127 lines changed

â†’ analyze-pr: AI agent reviewing...
  âœ“ Agent: pr-reviewer
  
  AI Code Review:
  
  Overall: LOOKS GOOD âœ“
  
  Key Findings:
  - Clean implementation of Divide function
  - Good test coverage including edge cases
  - Handles division by zero safely
  
  Suggestions:
  - Consider returning error instead of 0 for division by zero
  - Add documentation comment explaining zero-division behavior
  
âœ“ Workflow completed in 3.2s

Results exported as: pr-review-result
```

---

**Status:** Setup complete, ready for CLI implementation  
**Created:** January 20, 2026  
**Maintained by:** Stigmer Team
