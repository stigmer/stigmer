syntax = "proto3";

package ai.stigmer.tenancy.organization.v1;

import "ai/stigmer/commons/apiresource/rpc_service_options.proto";
import "ai/stigmer/iam/iampolicy/v1/rpcauthorization/method_options.proto";
import "ai/stigmer/tenancy/organization/v1/api.proto";
import "ai/stigmer/tenancy/organization/v1/io.proto";

// OrganizationCommandController provides write operations for organizations
service OrganizationCommandController {
  option (ai.stigmer.commons.apiresource.api_resource_kind) = organization;

  // Create or update an organization.
  // The authorization and state-operation are determined depending on whether the organization
  // is going to be created or updated which is determined as part of the request execution.
  rpc apply(Organization) returns (Organization);

  // Create a new organization
  // No authorization required - any authenticated user can create an organization
  // The creator automatically becomes the owner of the organization
  rpc create(Organization) returns (Organization) {
    option (ai.stigmer.iam.iampolicy.v1.rpcauthorization.is_skip_authorization) = true;
  }

  // Update an existing organization
  // Requires: Organization admin permission (can_edit)
  rpc update(Organization) returns (Organization) {
    option (ai.stigmer.iam.iampolicy.v1.rpcauthorization.config).resource_kind = organization;
    option (ai.stigmer.iam.iampolicy.v1.rpcauthorization.config).permission = can_edit;
    option (ai.stigmer.iam.iampolicy.v1.rpcauthorization.config).field_path = "metadata.id";
    option (ai.stigmer.iam.iampolicy.v1.rpcauthorization.config).error_msg = "unauthorized to update organization";
  }

  // Delete an organization
  // Requires: Organization owner permission (can_delete)
  // Note: This will cascade delete all resources under the organization
  rpc delete(OrganizationId) returns (Organization) {
    option (ai.stigmer.iam.iampolicy.v1.rpcauthorization.config).resource_kind = organization;
    option (ai.stigmer.iam.iampolicy.v1.rpcauthorization.config).permission = can_delete;
    option (ai.stigmer.iam.iampolicy.v1.rpcauthorization.config).field_path = "value";
    option (ai.stigmer.iam.iampolicy.v1.rpcauthorization.config).error_msg = "unauthorized to delete organization";
  }
}
