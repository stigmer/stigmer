syntax = "proto3";

package ai.stigmer.agentic.environment.v1;

import "ai/stigmer/agentic/environment/v1/api.proto";
import "ai/stigmer/commons/apiresource/io.proto";
import "ai/stigmer/commons/apiresource/rpc_service_options.proto";
import "ai/stigmer/iam/iampolicy/v1/rpcauthorization/method_options.proto";

// EnvironmentCommandController provides write operations for Environment resources.
service EnvironmentCommandController {
  option (ai.stigmer.commons.apiresource.api_resource_kind) = environment;

  // Create or update an Environment resource.
  // The authorization and state-operation are determined depending on whether the environment
  // is going to be created or updated which is determined as part of the request execution.
  rpc apply(Environment) returns (Environment);

  // Create a new Environment resource.
  rpc create(Environment) returns (Environment);

  // Update an existing Environment resource.
  rpc update(Environment) returns (Environment) {
    option (ai.stigmer.iam.iampolicy.v1.rpcauthorization.config).resource_kind = environment;
    option (ai.stigmer.iam.iampolicy.v1.rpcauthorization.config).permission = can_edit;
    option (ai.stigmer.iam.iampolicy.v1.rpcauthorization.config).field_path = "metadata.id";
    option (ai.stigmer.iam.iampolicy.v1.rpcauthorization.config).error_msg = "unauthorized to update environment";
  }

  // Delete an Environment resource.
  rpc delete(ai.stigmer.commons.apiresource.ApiResourceDeleteInput) returns (Environment) {
    option (ai.stigmer.iam.iampolicy.v1.rpcauthorization.config).resource_kind = environment;
    option (ai.stigmer.iam.iampolicy.v1.rpcauthorization.config).permission = can_edit;
    option (ai.stigmer.iam.iampolicy.v1.rpcauthorization.config).field_path = "metadata.id";
    option (ai.stigmer.iam.iampolicy.v1.rpcauthorization.config).error_msg = "unauthorized to delete environment";
  }
}
