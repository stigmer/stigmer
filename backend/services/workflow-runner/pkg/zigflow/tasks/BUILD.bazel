load("@rules_go//go:def.bzl", "go_library", "go_test")

go_library(
    name = "tasks",
    srcs = [
        "constants.go",
        "resolver.go",
        "task_builder.go",
        "task_builder_call_activity.go",
        "task_builder_call_agent.go",
        "task_builder_call_agent_activities.go",
        "task_builder_call_grpc.go",
        "task_builder_call_grpc_activities.go",
        "task_builder_call_http.go",
        "task_builder_call_http_activities.go",
        "task_builder_do.go",
        "task_builder_for.go",
        "task_builder_fork.go",
        "task_builder_listen.go",
        "task_builder_raise.go",
        "task_builder_run.go",
        "task_builder_run_activities.go",
        "task_builder_set.go",
        "task_builder_switch.go",
        "task_builder_try.go",
        "task_builder_wait.go",
    ],
    importpath = "github.com/leftbin/stigmer-cloud/backend/services/workflow-runner/pkg/zigflow/tasks",
    visibility = ["//visibility:public"],
    deps = [
        "//apis/stubs/go/ai/stigmer/agentic/agent/v1:agent",
        "//apis/stubs/go/ai/stigmer/agentic/agentexecution/v1:agentexecution",
        "//apis/stubs/go/ai/stigmer/agentic/executioncontext/v1:executioncontext",
        "//apis/stubs/go/ai/stigmer/agentic/workflow/v1/tasks",
        "//apis/stubs/go/ai/stigmer/commons/apiresource",
        "//apis/stubs/go/ai/stigmer/commons/apiresource/apiresourcekind",
        "//backend/services/workflow-runner/pkg/claimcheck",
        "//backend/services/workflow-runner/pkg/config",
        "//backend/services/workflow-runner/pkg/types",
        "//backend/services/workflow-runner/pkg/utils",
        "//backend/services/workflow-runner/pkg/zigflow/metadata",
        "//backend/services/workflow-runner/pkg/zigflow/models",
        "@com_github_fullstorydev_grpcurl//:grpcurl",
        "@com_github_rs_zerolog//log",
        "@com_github_serverlessworkflow_sdk_go_v3//impl/expr",
        "@com_github_serverlessworkflow_sdk_go_v3//impl/utils",
        "@com_github_serverlessworkflow_sdk_go_v3//model",
        "@io_temporal_go_api//enums/v1:enums",
        "@io_temporal_go_sdk//activity",
        "@io_temporal_go_sdk//temporal",
        "@io_temporal_go_sdk//worker",
        "@io_temporal_go_sdk//workflow",
        "@org_golang_google_grpc//:grpc",
        "@org_golang_google_grpc//credentials",
        "@org_golang_google_grpc//credentials/insecure",
    ],
)

go_test(
    name = "tasks_test",
    srcs = [
        "task_builder_call_activity_test.go",
        "task_builder_call_grpc_eval_test.go",
        "task_builder_call_http_eval_test.go",
        "task_builder_call_http_test.go",
        "task_builder_do_test.go",
        "task_builder_for_test.go",
        "task_builder_listen_test.go",
        "task_builder_raise_test.go",
        "task_builder_run_test.go",
        "task_builder_set_test.go",
        "task_builder_switch_test.go",
        "task_builder_test.go",
        "task_builder_wait_test.go",
    ],
    embed = [":tasks"],
    deps = [
        "//backend/services/workflow-runner/pkg/utils",
        "@com_github_serverlessworkflow_sdk_go_v3//model",
        "@com_github_stretchr_testify//assert",
        "@com_github_stretchr_testify//mock",
        "@com_github_stretchr_testify//require",
        "@io_temporal_go_sdk//activity",
        "@io_temporal_go_sdk//temporal",
        "@io_temporal_go_sdk//testsuite",
        "@io_temporal_go_sdk//workflow",
    ],
)
