# Golden Test 02: Switch/Conditional Branching
# Tests: Conditional branching with switch, HTTP GET/POST, data transformation
# CONVERTED TO DSL 1.0.0 FORMAT
# Workflow: Fetch a post from JSONPlaceholder API and branch based on userId

document:
  dsl: '1.0.0'
  namespace: golden-tests
  name: switch-conditional-test
  version: '1.0.0'
  description: Fetches a post and classifies user based on userId with conditional branching
do:
  # Step 1: Fetch post data from public API (GET request)
  - fetchPost:
      call: http
      with:
        method: GET
        endpoint:
          uri: https://jsonplaceholder.typicode.com/posts/7
      export:
        as: ${ . }
  
  # Step 2: Conditional branching based on userId from fetched post
  - classifyUser:
      switch:
        - highValueCase:
            when: ${ $context.userId > 5 }
            then: highValueUser
        - regularUserCase:
            when: ${ $context.userId <= 5 }
            then: regularUser
        - defaultCase:
            then: unknownUser
  
  # Step 3a: High value user path (userId > 5)
  - highValueUser:
      call: http
      with:
        method: POST
        endpoint:
          uri: https://jsonplaceholder.typicode.com/posts
        body:
          category: premium
          userId: ${ $context.userId }
          postId: ${ $context.id }
          message: High value user detected (userId > 5)
      then: end  # Terminate workflow after this branch
  
  # Step 3b: Regular user path (userId <= 5)
  - regularUser:
      call: http
      with:
        method: POST
        endpoint:
          uri: https://jsonplaceholder.typicode.com/posts
        body:
          category: standard
          userId: ${ $context.userId }
          postId: ${ $context.id }
          message: Regular user detected (userId <= 5)
      then: end  # Terminate workflow after this branch
  
  # Step 3c: Unknown user fallback (shouldn't happen with valid postId)
  - unknownUser:
      call: http
      with:
        method: POST
        endpoint:
          uri: https://jsonplaceholder.typicode.com/posts
        body:
          category: unknown
          message: Unable to classify user - userId missing
      then: end  # Terminate workflow after this branch

